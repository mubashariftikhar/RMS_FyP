<!DOCTYPE html>
<html lang="zxx" class="js">

<head>
    <base href="../">
    <meta charset="utf-8">
    <meta name="author" content="Softnio">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description"
        content="A powerful and conceptual apps base dashboard template that especially build for developers and programmers.">
    <!-- Fav Icon  -->
    <link rel="shortcut icon" href="folder address?">
    <!-- Page Title  -->
    <title>Admin Dashboard</title>
    <!-- StyleSheets  -->
    <link rel="stylesheet" href="./assets/css/kustfyp.css">
    <!-- <link id="skin-default" rel="stylesheet" href="./assets/css/theme.css">-->

</head>

<body class="nk-body bg-lighter npc-default has-sidebar ">
    <div class="nk-app-root">
        <!-- main  -->
        <div class="nk-main ">
            <!-- sidebar -->
            <div class="nk-sidebar nk-sidebar-fixed is-light " data-content="sidebarMenu">
                <div class="nk-sidebar-element nk-sidebar-head">
                    <div class="nk-sidebar-brand">
                        <a href="html/index.html" class="logo-link nk-sidebar-logo">
                            <img style="width: 80px !important;height: 250px !important;" class=" logo-img"
                                src="./images/logo.jpg" srcset="./images/logo.jpg 2x" alt="logo-small">
                        </a>
                    </div>
                    <div class="nk-menu-trigger mr-n2">
                        <a href="#" class="nk-nav-toggle nk-quick-nav-icon d-xl-none" data-target="sidebarMenu"><em
                                class="icon ni ni-arrow-left"></em></a>
                        <a href="#" class="nk-nav-compact nk-quick-nav-icon d-none d-xl-inline-flex"
                            data-target="sidebarMenu"><em class="icon ni ni-menu"></em></a>
                    </div>
                </div><!-- .nk-sidebar-element -->
                <div class="nk-sidebar-element">
                    <div class="nk-sidebar-content">
                        <div class="nk-sidebar-menu" data-simplebar>
                            <ul class="nk-menu">

                                <li class="nk-menu-heading">
                                    <h6 class="overline-title text-primary-alt">Dashboards</h6>
                                </li>
                                <!-- .nk-menu-Dashboard -->
                                <li class="nk-menu-item">
                                    <a href="html/index.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-cart-fill"></em></span>
                                        <span class="nk-menu-text">Dashboard</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-tabel -->
                                <li class="nk-menu-item">
                                    <a href="html/mytables.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em
                                                class="icon ni ni-activity-round-fill"></em></span>
                                        <span class="nk-menu-text">Tables</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Items -->
                                <li class="nk-menu-item">
                                    <a href="html/menu.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-list"></em></span>
                                        <span class="nk-menu-text">Menu Items</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Waiters -->
                                <li class="nk-menu-item">
                                    <a href="html/waiter.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-users"></em></span>
                                        <span class="nk-menu-text">Waiters</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Duty-Place -->
                                <li class="nk-menu-item">
                                    <a href="html/duty_place.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-map"></em></span>
                                        <span class="nk-menu-text">Duty Places</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Kithchen-Staff -->
                                <li class="nk-menu-item">
                                    <a href="html/kitchen.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-users"></em></span>
                                        <span class="nk-menu-text">Kitchen Staff</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Tabel-reservation -->
                                <li class="nk-menu-item">
                                    <a href="html/request_tabel_adv.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-growth-fill"></em></span>
                                        <span class="nk-menu-text">Requests for Table reservation</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Salaries -->
                                <li class="nk-menu-item">
                                    <a href="html/add_salaries.html" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-money"></em></span>
                                        <span class="nk-menu-text">Salaries</span>
                                    </a>
                                </li>
                                <!-- .nk-menu-Todays-orders -->
                                <li class="nk-menu-item">
                                    <a href="#" class="nk-menu-link">
                                        <span class="nk-menu-icon"><em class="icon ni ni-money"></em></span>
                                        <span class="nk-menu-text">Todays Orders</span>
                                    </a>
                                </li><!-- .nk-menu-item -->

                            </ul><!-- .nk-menu -->
                        </div><!-- .nk-sidebar-menu -->
                    </div><!-- .nk-sidebar-content -->
                </div><!-- .nk-sidebar-element -->
            </div>
            <!-- sidebar @e -->
            <!-- wrap @s -->
            <div class="nk-wrap ">
                <!-- main header @s -->
                <div class="nk-header nk-header-fixed is-light">
                    <div class="container-fluid">
                        <div class="nk-header-wrap">
                            <div class="nk-menu-trigger d-xl-none ml-n1">
                                <a href="#" class="nk-nav-toggle nk-quick-nav-icon" data-target="sidebarMenu"><em
                                        class="icon ni ni-menu"></em></a>
                            </div>
                            <div class="nk-header-tools">
                                <ul class="nk-quick-nav">
                                    <li class="dropdown user-dropdown">
                                        <a href="#" class="dropdown-toggle mr-n1" data-toggle="dropdown">
                                            <div class="user-toggle">
                                                <div class="user-avatar sm">
                                                    <em class="icon ni ni-user-alt"></em>
                                                </div>
                                                <div class="user-info d-none d-xl-block">
                                                    <div class="user-status user-status-unverified">Unverified</div>
                                                    <div class="user-name dropdown-indicator">Hujra Restaurants</div>
                                                </div>
                                            </div>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-md dropdown-menu-right">
                                            <div class="dropdown-inner user-card-wrap bg-lighter d-none d-md-block">
                                                <div class="user-card">
                                                    <div class="user-avatar">
                                                        <span>HR</span>
                                                    </div>
                                                    <div class="user-info">
                                                        <span class="lead-text">Hujra Restaurants</span>
                                                        <span class="sub-text">HR12@gmail.com</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dropdown-inner">
                                                <ul class="link-list">
                                                    <li><a href="html/user-profile-regular.html"><em
                                                                class="icon ni ni-user-alt"></em><span>View
                                                                Profile</span></a></li>
                                                    <li><a href="html/user-profile-activity.html"><em
                                                                class="icon ni ni-activity-alt"></em><span>Login
                                                                Activity</span></a></li>
                                                    <li><a class="dark-switch" href="#"><em
                                                                class="icon ni ni-moon"></em><span>Dark Mode</span></a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="dropdown-inner">
                                                <ul class="link-list">
                                                    <li><a href="#"><em class="icon ni ni-signout"></em><span>Sign
                                                                out</span></a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div><!-- .nk-header-wrap -->
                    </div><!-- .container-fliud -->
                </div>
                <!-- main header @e -->
                <!-- content @s -->
                <div class="nk-content ">
                    <div class="container-fluid">
                        <div class="nk-content-inner">
                            <div class="nk-content-body">
                                <!-- jQuery library -->
                                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

                                <!-- Latest compiled JavaScript -->
                                <script
                                    src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

                                <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog"
                                    aria-labelledby="myModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-hidden="true" style="color: #000000">&times;</button>
                                                <div align="center">
                                                    <h4 class="modal-title" id="myModalLabel"></h4>
                                                </div>
                                            </div>
                                            <div class="modal-body" style="font-size: 18px">
                                                <p style="text-align: center; color: #000000">You are about to delete
                                                    one
                                                    record, this procedure is irreversible.</p>
                                                <p style="text-align: center; color: #000000">Do you want to proceed?
                                                </p>
                                                <p class="debug-url" style="display: none"></p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default"
                                                    data-dismiss="modal">Cancel</button>
                                                <a class="btn btn-danger btn-ok" style="color: white">Delete</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <style>
                                    #loading2 {
                                        position: fixed;
                                        z-index: 10000;

                                    }

                                    #loading_overlay {
                                        position: fixed;
                                        top: 0;
                                        bottom: 0;
                                        left: 0;
                                        right: 0;
                                        text-align: center;
                                        font-size: 0;
                                        overflow-y: auto;
                                        background-color: rgba(0, 0, 0, .4);
                                        z-index: 9999;


                                        transition: opacity .3s;
                                    }

                                    #loader {
                                        top: calc(50% - 53px);
                                        left: calc(50% - 53px);
                                        position: fixed;
                                        z-index: 1040;
                                        border-radius: 50%;

                                    }
                                </style>
                                <div id="loading2" class="loader1" style="display: none">
                                    <div id="loading_overlay"></div>
                                    <div id="loader" style="background:#fff;padding:3px;">
                                        <img src="{{ url('public/loader.gif') }}" style="width:80px;height: auto;">
                                    </div>
                                </div>
                                <script src="https://cdn.ckeditor.com/4.12.1/standard/ckeditor.js"></script>
                                <div class="modal fade" tabindex="-1" id="modalTop">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Add Menu-Item</h5>
                                                <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                    <em class="icon ni ni-cross"></em>
                                                </a>
                                            </div>
                                            <div class="modal-body">
                                                <form id="menuForm" action="insert_table" method="post"
                                                    enctype="multipart/form-data">
                                                    <input type="hidden" name="_token"
                                                        value="<?php echo csrf_token(); ?>">
                                                    <div class="form-group">
                                                        <label class="form-label" for="full-name">Sr No #000000<No
                                                                id="1">
                                                            </No></label>
                                                        <div class="form-control-wrap">
                                                            <input type="text" name="expert_name" class="form-control"
                                                                id="menuCode" placeholder="Enter Menu Code"
                                                                required="required">
                                                        </div>
                                                        <label class="form-label" for="full-name">Menu Name</label>
                                                        <div class="form-control-wrap">
                                                            <input type="text" name="expert_name" class="form-control"
                                                                id="menuName" placeholder="Enter Menu Name"
                                                                required="required">
                                                        </div>
                                                        <label class="form-label" for="type=" $44">Price</label>
                                                        <div class="form-control-wrap">
                                                            <input type="text" name="expert_name" class="form-control"
                                                                id="menuPrice" placeholder="Enter Price"
                                                                required="required">
                                                        </div>
                                                    </div>
                                                    <button type="submit" class="btn btn-lg btn-primary"
                                                        style="float: right">Submit</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal fade" tabindex="-1" id="modalTop2">
                                    <div class="modal-dialog modal-lg" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="edit_modal_header"></h5>
                                                <a href="#" class="close" data-dismiss="modal" aria-label="Close">
                                                    <em class="icon ni ni-cross"></em>
                                                </a>
                                            </div>
                                            <div class="modal-body" id="edit_modal_body">

                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="components-preview wide-md mx-auto">
                                    <div class="nk-block nk-block-lg">
                                        <div class="nk-block-head nk-block-head-sm">
                                            <div class="nk-block-between">
                                                <div class="nk-block-head-content">
                                                    <h4 class="nk-block-title page-title">Menu Catagory</h4>
                                                    <div class="nk-block-des text-soft">
                                                    </div>
                                                </div><!-- .nk-block-head-content -->
                                                <div class="nk-block-head-content">
                                                    <div class="toggle-wrap nk-block-tools-toggle">
                                                        <a href="#" class="btn btn-icon btn-trigger toggle-expand mr-n1"
                                                            data-target="pageMenu"><em
                                                                class="icon ni ni-menu-alt-r"></em></a>
                                                        <div class="toggle-expand-content" data-content="pageMenu">
                                                            <ul class="nk-block-tools g-3">
                                                                <li class="nk-block-tools-opt">
                                                                    <button type="button" class="btn btn-primary"
                                                                        data-toggle="modal" data-target="#modalTop"><em
                                                                            class="icon ni ni-plus"></em>Add
                                                                        Menu-item</button>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div><!-- .toggle-wrap -->
                                                </div><!-- .nk-block-head-content -->
                                            </div><!-- .nk-block-between -->
                                        </div>
                                        <div class="card card-preview">

                                            <div class="card-inner">

                                                <table class="datatable-init table">
                                                    <thead>
                                                        <tr>
                                                            <th>Menu Code#</th>
                                                            <th>Menu Name</th>
                                                            <th>Menu Price</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="insertMenuData">
                                                        <tr>

                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div><!-- .card-preview -->
                                    </div> <!-- nk-block -->

                                </div><!-- .components-preview -->
                                <script type="text/javascript">
                                    CKEDITOR.replace('editor1', {
                                        filebrowserUploadUrl: "{{route('ckeditor.upload', ['_token' => csrf_token() ])}}",
                                        filebrowserUploadMethod: 'form'
                                    });

                                </script>

                                <script>
                                    function view_edit_modal(id) {
                                        $('#loading2').show();
                                        $("#edit_modal_header").html("Edit Expert Detail");
                                        $.get("{{ url('edit_expert') }}" + '/' + id, function (data, status) {
                                            $("#edit_modal_body").html(data.html);
                                            $('#loading2').hide();
                                        });
                                        $('#modalTop2').modal('show');
                                    }
                                </script>

                                <script>
                                    $(document).ready(function () {
                                        $('body').on('click', '.khan', function () {
                                            $('.btn-ok').attr('href', $(this).data('href'));
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- content @e -->
                <!-- footer @s -->
                <div class="nk-footer">
                    <div class="container-fluid">
                        <div class="nk-footer-wrap">
                            <div class="nk-footer-copyright"> &copy; 2023 Hujra Restaurants<a href="#"
                                    target="_blank">Kust
                                    FYP</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- footer @e -->
            </div>
            <!-- wrap @e -->
        </div>
        <!-- main @e -->
    </div>
    <!-- app-root @e -->
    <!-- JavaScript -->
    <script src="./assets/js/bundle.js?ver=2.5.0"></script>
    <script src="./assets/js/scripts.js?ver=2.5.0"></script>
    <script src="./assets/js/charts/chart-ecommerce.js?ver=2.5.0"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <script>
        console.log("connected")
        // console.log(sessionStorage.getItem("user"))
        const firebaseConfig = {
            apiKey: "AIzaSyBqtWhz7DJEZMcvbX-knY6Fxl-3JNWt_RI",
            authDomain: "rmsystem-45a87.firebaseapp.com",
            projectId: "rmsystem-45a87",
            storageBucket: "rmsystem-45a87.appspot.com",
            messagingSenderId: "204748760785",
            appId: "1:204748760785:web:907286c86e5af921f3c7f0",
            measurementId: "G-DWT7V8RV5V",
            databaseURL: "https://rmsystem.firebaseio.com",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const user = JSON.parse(sessionStorage.getItem('user'))



        $('#menuForm').on('submit', function (event) {
            event.preventDefault();
            console.log("button click")
            const menuCode = $('#menuCode').val();
            const menuName = $('#menuName').val();
            const menuPrice = $('#menuPrice').val();

            // getting resturant id
            db.collection('resturants')
                .where('userId', '==', user.id)
                .get()
                .then((querySnapshot) => {
                    console.log("connected")

                    if (!querySnapshot.empty) {
                        const doc = querySnapshot.docs[0];
                        console.log(doc.id)
                        const data = {
                            "name": menuName,
                            "code": menuCode,
                            "price": menuPrice,
                            "resturantId": doc.id.toString()
                        }
                        db.collection('menus').add(data)
                            .then(function (docRef) {
                                // Display success message using SweetAlert
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Success',
                                    text: 'Data added to Firestore successfully!',
                                    timer: 3000,
                                    showConfirmButton: false
                                });
                                // Reset the form
                                // $('#alarmingSituation')[0].reset();
                                //    window.href = "./"
                                location.reload();
                            })
                            .catch(function (error) {
                                // Display error message using SweetAlert
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'Failed to add data to Firestore!',
                                    timer: 3000,
                                    showConfirmButton: false
                                });
                            });
                    } else {
                        console.log('No restaurant found with the provided user ID.');
                    }
                })
                .catch((error) => {
                    console.log('Error getting restaurants: ', error);
                });



            // Print the table name in the console
            // console.log(tableName);
        });

        db.collection("menus")
            .get()
            .then((querySnapshot) => {
                let index = 0;
                querySnapshot.forEach((doc) => {
                    const data = doc.data();

                    $("#insertMenuData").append(` <tr data-key=${doc.id}>
                                                        <td>${data.code}</td>
                                                        <td>${data.name}</td>
                                                        <td>${data.price}</td>
                                                        <td style="text-align: center">
                                                            <a class="btn btn-primary btn-sm edit-table"><em
                                        style="color: white"
                                        class="icon ni ni-pen "></em></a>
                                <a data-toggle="modal" 
                                    class="khan btn btn-danger btn-sm delete-table"><em
                                        style="color: white"
                                        class="icon ni ni-trash "></em></a>
                                                        </td>
                                                    </tr>`);
                    index++;
                });
            })
            .catch((error) => {
                console.log("Error getting documents: ", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to add data to Firestore!',
                    timer: 3000,
                    showConfirmButton: false
                });
            });


        // $("#insetTableData").on("click", ".edit-table", function () {
        //     var tableId = $(this).closest("tr").attr("data-key");
        //     // Perform the edit action for the table with the ID tableId
        //     // Your code here
        //     console.log(tableId)

        // });

        $("#insertMenuData").on("click", ".delete-table", function () {
            var menuId = $(this).closest("tr").attr("data-key");
            // Perform the delete action for the items with the ID tableId
            // Your code here
            console.log(menuId)
            var tableRef = db.collection("menus").doc(menuId);

            // Delete the table document
            tableRef.delete().then(function () {
                console.log("Menu item deleted successfully!");
                // Remove the table row from the HTML
                location.reload();
                // $(this).closest("tr").remove();
            }).catch(function (error) {
                console.error("Error deleting table: ", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to delete the table!',
                    timer: 3000,
                    showConfirmButton: false
                });
            });

        });



    </script>

</body>

</html>